<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voucher Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0D1B2A;
            color: #E0E1DD;
            position: relative;
            font-size: 12pt;
            max-height: 99%;
            margin: 0;
            padding: 0;
        }
        @keyframes blinkBorder {
            0% {
                border-bottom-color: transparent;
            }
            50% {
                border-bottom-color: #415A77;
            }
            100% {
                border-bottom-color: transparent;
            }
        }
        .parent{
            display: flex;
            align-items: center;
            justify-content: center;
            height: 99%;
        }
        .child{
            flex-direction: column;
        }
        h2 {
            margin:0;
            padding:0;
        }
        button {
            background-color: #1B263B;
            color: #E0E1DD;
            border: none;
            border-radius: 4px;
            width: 50vw;
            height: 40px;
        }
        select {
            background-color: transparent;
            border: none;
            color: #E0E1DD;
            padding-left: 10px;
            width: 47vw;
            height: 40px;
            outline: none;
        }
        .select-custom{
            background-color: #1B263B;
            border: none;
            border-radius: 4px;
            width: 50vw;
            height: 40px;
        }
        input, input:focus {
            margin: 5px 0;
            background-color: #1B263B;
            border: 0;
            padding: 8px;
            border-radius: 4px;
            outline: none;
            color: #E0E1DD;
            width: 50vw;
            height: 40px;
            padding-left:13px;
        }
        input:focus{
            border-bottom: 1px solid transparent;
            animation: blinkBorder 1s infinite;
        }
        input::placeholder{
            color: #415A77;
            font-size: 12pt;
        }
        .button-container {
            overflow: hidden;
            margin-right: 20px;
            margin-top: 20px;
            margin-left: 20px;
        }
        button#exportBtn, button#copyBtn {
            float: right;
            margin-left: 10px;
            display: none;
            background-color: #1B263B;
            color: #E0E1DD;
            border: none;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
        }
        .terminal-label {
            float: left;
            margin-top: 10px;
            display: none;
        }
        pre {
            display: none;
            white-space: pre-wrap;
            word-wrap: break-word;
            padding: 2vw;
            background-color: #1B263B;
            border: 1px solid #415A77;
            color: #778DA9;
            border-radius: 5px;
            overflow-x: auto;
            margin-right: 20px;
            margin-bottom: 20px;
            margin-left: 20px;
            font-size: 10pt;
            text-align: justify;
        }
        .output {
            display: block;
            position: absolute;
            margin-bottom:20px;
            width: 100%;
        }
        .button-ExportGenerate {
            width: 50vw;
            height: 40px;
            border: 2px solid #3A86FF;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        .button-ExportCopy {
            width: 80px;
            height: 40px;
            border: 2px solid #3A86FF;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        #backBtn {
            padding-top: 8px;
            position: fixed;
            bottom: 20px;
            left: 50%;
            display: none;
            width: 47px;
            height: 47px;
            transform: translateX(-50%);
            border-radius: 50%;
            background-color: #E0E1DD;
            border: none;
            cursor: pointer;
            border: 1px solid #415A77;
            -webkit-tap-highlight-color: transparent;
        }
        .button-close {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 50px;
            -webkit-tap-highlight-color: transparent;
        }

        .button-x {
            position: relative;
            width: 30px;
            height: 30px;
            outline: none; /* Menghilangkan kotak biru saat ditekan */
            -webkit-tap-highlight-color: transparent;
        }
        .line {
            position: absolute;
            width: 100%;
            height: 4px;
            background-color: #0D1B2A;
            transition: transform 0.3s ease;
        }

        .line1 {
            top: 50%;
            transform: translateY(-50%) rotate(45deg);
        }
        .line2 {
            top: 50%;
            transform: translateY(-50%) rotate(-45deg);
        }
        .button-x:hover .line1 {
            transform: translateY(-50%) rotate(-45deg);
        }
        .button-x:hover .line2 {
            transform: translateY(-50%) rotate(45deg);
        }
        .button-x:focus {
            outline: none;
        }
        .center-text{
            text-align: center;
        }
    </style>
</head>
<body>
<div class="parent" id="title">
    <div class="child">
    <h2 id="title" class="center-text">GET</h2>
    <h2 id="title" class="center-text">VOUCHER</h2>

    <div class="button-container">
        <input type="number" id="numVouchers" min="1" required placeholder="How many voucher?">
        <br>
        <div class="select-custom">
            <select id="profile" required>
                <option value="7d">7 Hari</option>
                <option value="24h">24 Jam</option>
                <option value="12h">12 Jam</option>
                <option value="5h">5 Jam</option>
                <option value="2h">2 Jam</option>
            </select>
        </div>
        <br>
        <button onclick="generateVouchers()" class="button-ExportGenerate">GENERATE</button>
    </div>
    </div>
</div>
<div class="button-container">
    <span id="terminalLabel" class="terminal-label">Terminal :</span>
    <button id="exportBtn" class="button-ExportCopy" onclick="exportToPDF()">EXPORT</button>
    <button id="copyBtn" class="button-ExportCopy" onclick="copyToClipboard()">COPY</button>
</div>
<div class="output">
    <pre id="output"></pre>
</div>

<button id="backBtn" onclick="showGenerateForm()" class="button-ExportGenerate">
    <div class="button-close">
        <div class="button-x" tabindex="0">
            <div class="line line1"></div>
            <div class="line line2"></div>
        </div>
    </div>
</button>

<script>
    let vouchers = [];
    let selectedProfileText = '';

    function generateVouchers() {
        const numVouchersInput = document.getElementById('numVouchers');
        const numVouchers = parseInt(numVouchersInput.value);
        
        if (isNaN(numVouchers) || numVouchers < 1) {
            alert('Only numbet can allow.');
            numVouchersInput.focus();
            return;
        }

        const profileSelect = document.getElementById('profile');
        const profile = profileSelect.value;

        switch (profile) {
            case '7d':
                selectedProfileText = 'Voucher 7D';
                break;
            case '24h':
                selectedProfileText = 'Voucher 24H';
                break;
            case '12h':
                selectedProfileText = 'Voucher 12H';
                break;
            case '5h':
                selectedProfileText = 'Voucher 5H';
                break;
            case '2h':
                selectedProfileText = 'Voucher 2H';
                break;
            default:
                break;
        }
        
        const output = document.getElementById('output');
        const mikrotikCommands = [];
        
        vouchers = [];
        output.textContent = '';
        
        for (let i = 0; i < numVouchers; i++) {
            const username = profile + generateCode();
            const password = generateCode();
            vouchers.push({username, password});
            mikrotikCommands.push(`/ip hotspot user add name=${username} password=${password} profile="${selectedProfileText}"`);
        }
        
        output.textContent = mikrotikCommands.join('\n');
        
        // Tampilkan pre dan tombol setelah generate
        const preElement = document.getElementById('output');
        preElement.style.display = 'block';

        document.getElementById('exportBtn').style.display = 'block';
        document.getElementById('copyBtn').style.display = 'block';
        document.getElementById('terminalLabel').style.display = 'inline';

        // Sembunyikan form generate dan judul
        const formContainer = document.querySelector('.button-container');
        formContainer.style.display = 'none';

        const title = document.getElementById('title');
        title.style.display = 'none';
        const parent = document.getElementById('parent');
        title.style.display = 'none';

        // Tampilkan tombol "Kembali"
        const backButton = document.getElementById('backBtn');
        backButton.style.display = 'inline';
    }

    function showGenerateForm() {
        // Tampilkan kembali form generate dan judul
        const formContainer = document.querySelector('.button-container');
        formContainer.style.display = 'block';

        const title = document.getElementById('title');
        title.style.display = 'block';
        const parent = document.getElementById('parent');
        title.style.display = 'flex';

        // Sembunyikan output dan tombol ekspor
        const output = document.getElementById('output');
        output.textContent = '';
        output.style.display = 'none';

        document.getElementById('exportBtn').style.display = 'none';
        document.getElementById('copyBtn').style.display = 'none';
        document.getElementById('terminalLabel').style.display = 'none';

        // Sembunyikan tombol "Kembali"
        const backButton = document.getElementById('backBtn');
        backButton.style.display = 'none';
    }

    function generateCode() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let result = '';
        for (let i = 0; i < 8; i++) {
            result += chars.charAt(Math.random() * chars.length);
        }
        return result;
    }

    function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const margin = 10;
        const cellWidth = (doc.internal.pageSize.getWidth() - margin * 2) / 4;
        const cellHeight = 35;

        doc.setLineWidth(0.5);

        vouchers.forEach((voucher, index) => {
            const col = index % 4;
            const row = Math.floor(index / 4) % 8;
            const page = Math.floor(index / 32);

            if (index % 32 === 0 && index > 0) {
                doc.addPage();
                doc.setLineWidth(0.5);
            }

            const x = margin + col * cellWidth;
            const y = margin + row * cellHeight;

            doc.rect(x, y, cellWidth, cellHeight);

            doc.setFontSize(10);
            const labelWidth = doc.getStringUnitWidth(selectedProfileText) * 10 / doc.internal.scaleFactor;
            const labelX = x + (cellWidth - labelWidth) / 2;
            const labelY = y + 6;
            doc.text(selectedProfileText, labelX, labelY);

            doc.setLineDash([2, 2], 0);
            doc.line(x, labelY + 3, x + cellWidth, labelY + 3);
            doc.setLineDash([]);

            doc.setFontSize(10);
            const textY = labelY + 8;
            doc.text(`Username: ${voucher.username}`, x + 2, textY);
            doc.text(`Password: ${voucher.password}`, x + 2, textY + 5);

            doc.setLineDash([2, 2], 0);
            doc.line(x, textY + 7, x + cellWidth, textY + 7);
            doc.setLineDash([]);

            doc.setFontSize(9);
            const infoX = x + 2;
            let infoY = textY + 12;
            const infoLines = doc.splitTextToSize(`-Masuk kedalam wifi "Home-.." -Ketik pada broswer "starbit.id"  atau ketik "10.10.10.1"`, cellWidth - 4);
            infoLines.forEach(line => {
                doc.text(line, infoX, infoY);
                infoY += 3;
            });
        });

        const fileName = `Voucher (${selectedProfileText}).pdf`;
        doc.save(fileName);
    }

    function copyToClipboard() {
        const output = document.getElementById('output');
        const textArea = document.createElement('textarea');
        textArea.textContent = output.textContent;
        document.body.append(textArea);
        textArea.select();
        document.execCommand('copy');
        textArea.remove();
        alert('Copied to clipboard!');
    }
</script>

<button id="backBtn" onclick="showGenerateForm()">
    <div class="button-close">
        <div class="button-x" tabindex="0">
            <div class="line line1"></div>
            <div class="line line2"></div>
        </div>
    </div>
</button>

</body>
</html>