<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voucher Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #0D1B2A;
            color: #E0E1DD;
            position: relative; /* Untuk memudahkan penempatan tombol fixed */
            min-height: 100vh; /* Mengisi tinggi minimum halaman */
            
        }
        input, select, button {
            margin: 5px 0;
            background-color: #1B263B;
            color: #E0E1DD;
            border: none;
            padding: 8px;
            border-radius: 4px;
        }
        .button-container {
            overflow: hidden;
            margin-bottom: 10px;
        }
        button#exportBtn,
        button#copyBtn {
            float: right;
            margin-left: 10px;
            display: none;
            background-color: #1B263B;
            color: #E0E1DD;
            border: none;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
        }
        .terminal-label {
            float: left;
            margin-top: 10px;
            display: none;
        }
        pre {
            display: none;
            white-space: pre-wrap;
            word-wrap: break-word;
            padding: 10px;
            background-color: #1B263B;
            border: 1px solid #415A77;
            color: #778DA9;
            border-radius: 5px;
            overflow-x: auto;
        }
        .button-ExportGenerate {
            width: 25vw;
            height: 40px;
            border: 2px solid #3A86FF;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        @keyframes blinking-border {
            0%, 100% { border-bottom-color: transparent; }
            50% { border-bottom-color: #E0E1DD; }
        }
        .button-ExportCopy {
            width: 80px;
            height: 40px;
            border: 2px solid #3A86FF;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        #backBtn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            z-index: 999;
        }
    </style>
</head>
<body>
<h1 id="title">Voucher Generator</h1>
<div class="button-container">
    <label for="numVouchers">Number of Vouchers:</label>
    <input type="number" id="numVouchers" min="1" required>
    <br>
    <label for="profile">Profile:</label>
    <select id="profile" required>
        <option value="7d">7 Hari</option>
        <option value="24h">24 Jam</option>
        <option value="12h">12 Jam</option>
        <option value="5h">5 Jam</option>
        <option value="2h">2 Jam</option>
    </select>
    <br>
    <button onclick="generateVouchers()" class="button-ExportGenerate">GENERATE</button>
</div>

<div class="button-container">
    <span id="terminalLabel" class="terminal-label">Terminal :</span>
    <button id="exportBtn" class="button-ExportCopy" onclick="exportToPDF()">EXPORT PDF</button>
    <button id="copyBtn" class="button-ExportCopy" onclick="copyToClipboard()">COPY TO CLIPBOARD</button>
</div>

<pre id="output"></pre>

<button id="backBtn" onclick="showGenerateForm()" class="button-ExportGenerate">KEMBALI</button>

<script>
    let vouchers = [];
    let selectedProfileText = '';

    function generateVouchers() {
        const numVouchersInput = document.getElementById('numVouchers');
        const numVouchers = parseInt(numVouchersInput.value);
        
        if (isNaN(numVouchers) || numVouchers < 1) {
            alert('Please enter a valid number of vouchers (minimum 1).');
            numVouchersInput.focus();
            return;
        }

        const profileSelect = document.getElementById('profile');
        const profile = profileSelect.value;

        switch (profile) {
            case '7d':
                selectedProfileText = 'Voucher 7D';
                break;
            case '24h':
                selectedProfileText = 'Voucher 24H';
                break;
            case '12h':
                selectedProfileText = 'Voucher 12H';
                break;
            case '5h':
                selectedProfileText = 'Voucher 5H';
                break;
            case '2h':
                selectedProfileText = 'Voucher 2H';
                break;
            default:
                break;
        }
        
        const output = document.getElementById('output');
        const mikrotikCommands = [];
        
        vouchers = [];
        output.textContent = '';
        
        for (let i = 0; i < numVouchers; i++) {
            const username = profile + generateCode();
            const password = generateCode();
            vouchers.push({username, password});
            mikrotikCommands.push(`/ip hotspot user add name=${username} password=${password} profile="${selectedProfileText}"`);
        }
        
        output.textContent = mikrotikCommands.join('\n');
        
        // Tampilkan pre dan tombol setelah generate
        const preElement = document.getElementById('output');
        preElement.style.display = 'block';

        document.getElementById('exportBtn').style.display = 'block';
        document.getElementById('copyBtn').style.display = 'block';
        document.getElementById('terminalLabel').style.display = 'inline';

        // Sembunyikan form generate dan judul
        const formContainer = document.querySelector('.button-container');
        formContainer.style.display = 'none';

        const title = document.getElementById('title');
        title.style.display = 'none';

        // Tampilkan tombol "Kembali"
        const backButton = document.getElementById('backBtn');
        backButton.style.display = 'inline';
    }

    function showGenerateForm() {
        // Tampilkan kembali form generate dan judul
        const formContainer = document.querySelector('.button-container');
        formContainer.style.display = 'block';

        const title = document.getElementById('title');
        title.style.display = 'block';

        // Sembunyikan output dan tombol ekspor
        const output = document.getElementById('output');
        output.textContent = '';
        output.style.display = 'none';

        document.getElementById('exportBtn').style.display = 'none';
        document.getElementById('copyBtn').style.display = 'none';
        document.getElementById('terminalLabel').style.display = 'none';

        // Sembunyikan tombol "Kembali"
        const backButton = document.getElementById('backBtn');
        backButton.style.display = 'none';
    }

    function generateCode() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let result = '';
        for (let i = 0; i < 8; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }

    function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const margin = 10;
        const cellWidth = (doc.internal.pageSize.getWidth() - margin * 2) / 4;
        const cellHeight = 35;

        doc.setLineWidth(0.5);

        vouchers.forEach((voucher, index) => {
            const col = index % 4;
            const row = Math.floor(index / 4) % 8;
            const page = Math.floor(index / 32);

            if (index % 32 === 0 && index > 0) {
                doc.addPage();
                doc.setLineWidth(0.5);
            }

            const x = margin + col * cellWidth;
            const y = margin + row * cellHeight;

            doc.rect(x, y, cellWidth, cellHeight);

            doc.setFontSize(10);
            const labelWidth = doc.getStringUnitWidth(selectedProfileText) * 10 / doc.internal.scaleFactor;
            const labelX = x + (cellWidth - labelWidth) / 2;
            const labelY = y + 6;
            doc.text(selectedProfileText, labelX, labelY);

            doc.setLineDash([2, 2], 0);
            doc.line(x, labelY + 3, x + cellWidth, labelY + 3);
            doc.setLineDash([]);

            doc.setFontSize(10);
            const textY = labelY + 8;
            doc.text(`Username: ${voucher.username}`, x + 2, textY);
            doc.text(`Password: ${voucher.password}`, x + 2,
            textY + 5);

            doc.setLineDash([2, 2], 0);
            doc.line(x, textY + 7, x + cellWidth, textY + 7);
            doc.setLineDash([]);

            doc.setFontSize(9);
            const infoX = x + 2;
            let infoY = textY + 12;
            const infoLines = doc.splitTextToSize(`-Masuk kedalam wifi "Home-.." -Ketik pada broswer "starbit.id"  atau ketik "10.10.10.1"`, cellWidth - 4);
            infoLines.forEach(line => {
                doc.text(line, infoX, infoY);
                infoY += 3;
            });
        });

        const fileName = `Voucher (${selectedProfileText}).pdf`;
        doc.save(fileName);
    }

    function copyToClipboard() {
        const output = document.getElementById('output');
        const textArea = document.createElement('textarea');
        textArea.textContent = output.textContent;
        document.body.append(textArea);
        textArea.select();
        document.execCommand('copy');
        textArea.remove();
        alert('Copied to clipboard!');
    }
</script>

<button id="backBtn" onclick="showGenerateForm()" class="button-ExportGenerate">KEMBALI</button>

</body>
</html>